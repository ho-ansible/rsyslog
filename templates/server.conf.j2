## /etc/rsyslog.conf
## Server receives remote logs
## {{ ansible_managed }}

module(load="imklog")			# local kernel log
module(load="imudp")			# UDP syslog
module(load="imrelp")			# rsyslog reliable transport

input(type="imudp" port="514" ruleset="fromUDP")
input(type="imrelp" port="{{ rsyslog_port }}")

$RepeatedMsgReduction on	# Filter duplicated messages

# Set the default permissions for all log files.
$FileOwner root
$FileGroup adm
$FileCreateMode 0640
$DirCreateMode 0755
$Umask 0022

$WorkDirectory /var/spool/rsyslog	# Location of spool files

# Output Rules

ruleset(name="relp") {
}

{% for tag in rsyslog_tags %}
:syslogtag, contains, "{{ tag }}"	/var/log/{{ tag }}.log
& ~
{% endfor %}

{% for tag, rule in rsyslog_rules.iteritems() %}
{{ rule }}			/var/log/{{ tag }}.log
{% endfor %}

# Default
*.*				-{{ rsyslog_file }}
